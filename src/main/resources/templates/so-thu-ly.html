<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>S·ªï Th·ª• L√Ω</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>

    <style>
        .content-note {
            font-size: 12px;
            font-weight: normal;
        }

        /* scroll ngang */
        .table-responsive-horizontal {
            overflow-x: auto;
            /*white-space: nowrap;*/
            position: relative;
        }

        /* C·ªë ƒë·ªãnh c·ªôt H√†nh ƒë·ªông */
        th.sticky-action,
        td.sticky-action {
            position: sticky;
            right: 0;
            background: #ffffff;
            z-index: 10;

            /* Th√™m border r√µ r√†ng */
            border-left: 2px solid #dee2e6;   /* Gi·ªëng border table Bootstrap */
            border-right: 2px solid #dee2e6;
            box-shadow: -4px 0 6px -2px rgba(0,0,0,0.2);
        }

        /* Header ∆∞u ti√™n h∆°n body */
        th.sticky-action {
            z-index: 11;
        }

        .copy-tooltip {
            position: absolute;
            top: -22px;
            left: 0;
            background: #000;
            color: #fff;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 4px;
            white-space: nowrap;
            opacity: 1;
            transition: opacity 0.3s ease;
            z-index: 999;
        }

        .copy-tooltip.fade-out {
            opacity: 0;
        }

        .btn-copy {
            border: none !important;       /* b·ªè border */
            outline: none !important;      /* b·ªè outline khi focus */
            background: transparent;       /* b·ªè n·ªÅn */
            padding: 0 4px;                /* thu nh·ªè n√∫t cho g·ªçn */
            cursor: pointer;               /* con tr·ªè d·∫°ng click */
        }

        .btn-copy i {
            font-size: 14px;
            color: #666;                   /* m√†u icon copy */
            transition: 0.2s;
        }

        /* hi·ªáu ·ª©ng nh·∫•n copy */
        .btn-copy.copied i {
            color: #000;
            transform: scale(1.3);
        }


        /* Hi·ªáu ·ª©ng hover chung cho t·∫•t c·∫£ button */
        .btn,
        .btn-copy {
            transition: transform 0.15s ease, box-shadow 0.15s ease, background-color 0.15s ease;
        }

        /* Hover: h∆°i n·ªïi l√™n + ƒë·ªï b√≥ng nh·∫π */
        .btn:hover,
        .btn-copy:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        /* Khi click gi·ªØ chu·ªôt: h∆°i thu nh·ªè l·∫°i */
        .btn:active,
        .btn-copy:active {
            transform: scale(0.97);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* ===== Ripple effect khi click ===== */

        .btn,
        .btn-copy {
            position: relative;
            overflow: hidden; /* ƒë·ªÉ ripple kh√¥ng tr√†n ra ngo√†i */
        }

        /* Ph·∫ßn t·ª≠ ripple */
        .ripple {
            position: absolute;
            border-radius: 50%;
            transform: scale(0);
            animation: ripple 0.6s linear;
            background-color: rgba(0, 0, 0, 0.2);
            pointer-events: none;
        }

        /* Animation cho ripple */
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

    </style>
</head>
<body class="p-4">
<!-- ‚¨á‚¨á‚¨á LOADER ƒê∆Ø·ª¢C INJECT ·ªû ƒê√ÇY -->
<div th:replace="fragments/loader :: loader"></div>
<!-- ‚¨Ü‚¨Ü‚¨Ü -->

<h2>S·ªî TH·ª§ L√ù KI·ªÇM S√ÅT THI H√ÄNH √ÅN D√ÇN S·ª∞</h2>

<!-- ======================= T√åM KI·∫æM ======================= -->
<div class="d-flex gap-3 mb-3 align-items-end">
    <button class="btn btn-danger" onclick="deleteMultiple()">X√≥a nhi·ªÅu</button>
    <button class="btn btn-info gap-2" onclick="searchData()">
        <i class="fa fa-search"></i> T√¨m
    </button>

    <div class="d-flex align-items-center gap-2">
        <label class="form-label mb-0">T·ª´ ng√†y</label>
        <input id="searchFrom" class="form-control" style="width:150px;" placeholder="dd-MM-yyyy">
    </div>

    <div class="d-flex align-items-center gap-2">
        <label class="form-label mb-0">ƒê·∫øn ng√†y</label>
        <input id="searchTo" class="form-control" style="width:150px;" placeholder="dd-MM-yyyy">
    </div>

    <div class="d-flex gap-2 ms-auto">
        <button class="btn btn-primary" onclick="openCreateModal()">+ Th√™m m·ªõi</button>
        <button class="btn btn-success" onclick="exportExcel()">Export Excel</button>
    </div>

</div>

<!-- ======================= TABLE ======================= -->
<div class="table-responsive-horizontal">
    <table class="table table-bordered table-striped table-sm">
        <thead class="table-cell">
        <tr>
            <th rowspan="2" class="text-center align-middle">
                <input type="checkbox" id="checkAll" onclick="toggleCheckAll(this)">
            </th>
            <th rowspan="2" class="text-center align-middle">ID</th>
            <th rowspan="2" class="text-center align-middle">Ng√†y TL</th>
            <th rowspan="2" class="text-center align-middle">B·∫£n √°n, Quy·∫øt ƒë·ªãnh<br><span class="content-note">(S·ªë; Ng√†y, th√°ng, nƒÉm; C∆° quan ban h√†nh)</span></th>
            <th rowspan="2" class="text-center align-middle">Ng∆∞·ªùi ph·∫£i thi h√†nh<br><span class="content-note">(t√™n ƒë·ªãa ch·ªâ)</span></th>
            <th rowspan="2" class="text-center align-middle">Ng∆∞·ªùi ƒë∆∞·ª£c thi h√†nh<br><span class="content-note">(t√™n ƒë·ªãa ch·ªâ)</span></th>
            <th rowspan="2" class="text-center align-middle">Qƒê ·ª¶y th√°c ƒëi<br><span class="content-note">(S·ªë; Ng√†y, th√°ng, nƒÉm; S·ªë ti·ªÅn; N∆°i BH)</span></th>
            <th rowspan="2" class="text-center align-middle">Qƒê ·ª¶y th√°c ƒë·∫øn<br><span class="content-note">(S·ªë; Ng√†y, th√°ng, nƒÉm; S·ªë ti·ªÅn; N∆°i BH)</span></th>

            <th rowspan="2" class="text-center align-middle">Qƒê thi h√†nh √°n d√¢n s·ª±<br><span class="content-note">(S·ªë; Ng√†y, th√°ng, nƒÉm; S·ªë ti·ªÅn)</span></th>
            <th rowspan="2" class="text-center align-middle">N·ªôi dung thi h√†nh<br><span class="content-note">(C√°c kho·∫£n ph·∫£i thi h√†nh, s·ªë ti·ªÅn)</span></th>
            <th rowspan="2" class="text-center align-middle">Qƒê v·ªÅ vi·ªác ch∆∞a c√≥ ƒëi·ªÅu ki·ªán thi h√†nh √°n d√¢n s·ª±<br><span class="content-note">(S·ªë; Ng√†y, th√°ng, nƒÉm; S·ªë ti·ªÅn)</span></th>
            <th rowspan="2" class="text-center align-middle">Qƒê r√∫t Quy·∫øt ƒë·ªãnh THA<br><span class="content-note">(S·ªë; Ng√†y, th√°ng, nƒÉm; S·ªë ti·ªÅn)</span></th>


            <th colspan="2" class="text-center align-middle">Qƒê ho√£n thi h√†nh √°n D√¢n s·ª±</th>

            <th colspan="2" class="text-center align-middle">Qƒê t·∫°m ƒë√¨nh ch·ªâ thi h√†nh √°n d√¢n s·ª±</th>

            <th rowspan="2" class="text-center align-middle">Qƒê ƒë√¨nh ch·ªâ thi h√†nh √°n d√¢n s·ª±<br><span class="content-note">(S·ªë; Ng√†y, th√°ng, nƒÉm; S·ªë ti·ªÅn)</span></th>
            <th rowspan="2" class="text-center align-middle">ƒê√£ thi h√†nh xong<br><span class="content-note">(S·ªë; Ng√†y, th√°ng, nƒÉm; S·ªë ti·ªÅn)</span></th>

            <th rowspan="2" class="text-center align-middle">Ki·ªÉm s√°t vi√™n</th>
            <th rowspan="2" class="text-center align-middle">V·ªÅ th·ªùi h·∫°n g·ª≠i Quy·∫øt ƒë·ªãnh</th>
            <th rowspan="2" class="text-center align-middle">V·ªÅ cƒÉn c·ª© ban h√†nh Quy·∫øt ƒë·ªãnh</th>
            <th rowspan="2" class="text-center align-middle">V·ªÅ th·∫©m quy·ªÅn ban h√†nh Quy·∫øt ƒë·ªãnh</th>
            <th rowspan="2" class="text-center align-middle">V·ªÅ h√¨nh th·ª©c c·ªßa Quy·∫øt ƒë·ªãnh</th>
            <th rowspan="2" class="text-center align-middle">V·ªÅ n·ªôi dung c·ªßa Quy·∫øt ƒë·ªãnh</th>
            <th rowspan="2" class="text-center align-middle">Nh·ªØng n·ªôi dung kh√°c</th>
            <th rowspan="2" class="text-center align-middle">Quan ƒëi·ªÉm c·ªßa KSV</th>
            <th rowspan="2" class="text-center align-middle">Khu v·ª±c</th>
            <th rowspan="2" class="text-center align-middle">T√™n Vi·ªán KSND C·∫•p</th>
            <th rowspan="2" class="text-center align-middle">M√£ Phi·∫øu</th>
            <th rowspan="2" class="text-center align-middle sticky-action">H√†nh ƒë·ªông</th>
        </tr>
        <tr>
            <th class="align-middle"><span class="content-note">S·ªë; Ng√†y, th√°ng, nƒÉm; L√Ω do S·ªë ti·ªÅn</span></th>
            <th class="align-middle">Qƒê ti·∫øp t·ª•c THA<br><span class="content-note">(S·ªë; Ng√†y, th√°ng, nƒÉm)</span></th>

            <th class="align-middle"><span class="content-note">S·ªë; Ng√†y, th√°ng, nƒÉm; L√Ω do S·ªë ti·ªÅn</span></th>
            <th class="align-middle">Qƒê ti·∫øp t·ª•c THA<br><span class="content-note">(S·ªë; Ng√†y, th√°ng, nƒÉm)</span></th>
        </tr>
        </thead>

        <tbody id="tableBody">

        <!-- Load l·∫ßn ƒë·∫ßu n·∫øu c√≥ d·ªØ li·ªáu -->
        <tr th:each="item, stat : ${list}">
            <td class="text-center">
                <input type="checkbox" class="row-check" value="${item.id}">
            </td>
            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${stat.count}"></span>
            </td>
            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.formatDateNgayTl}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.banAnQuyetDinh}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.personWhoMustExecute}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.personToBeExecuted}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.qdUyThacDi}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.qdUyThacDen}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.qdTha}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.ndThiHanh}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.qdChuaCoDieuKien}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.qdRutTha}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.qdHoanTha}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.qdTiepTucSauHoan}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.qdTamDinhChi}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.qdTiepTucSauTamDinhChi}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.qdDinhChi}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.daThiHanhXong}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.ghiChu}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.veThoiHanGuiQD}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.veCanCuBanHanhQD}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.veThamQuyenBanHanhQD}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.veHinhThucQD}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.veNoiDungQD}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.noiDungKhac}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.quanDiemKSV}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.khuVuc}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.vienKsndCap}"></span>
            </td>

            <td>
                <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                <span th:text="${item.maPhieu}"></span>
            </td>

            <td th:class="sticky-action" class="sticky-action">
                <button class="btn btn-warning btn-sm"
                        th:onclick="'openEditModal(' + ${item.id} + ')'">S·ª≠a</button>
                <button class="btn btn-danger btn-sm"
                        th:onclick="'deleteItem(' + ${item.id} + ')'">X√≥a</button>
                <button class="btn btn-info btn-sm"
                        th:onclick="'showloadFileDoc(' + ${item.id} + ')'"><i class="fa fa-download"></i> .Doc</button>
                <button class="btn btn-secondary btn-sm mt-1"
                        th:onclick="'copyRow(' + ${item.id} + ')'">
                    Copy h√†ng
                </button>
            </td>
        </tr>

        </tbody>
    </table>
</div>

<!-- PAGINATION -->
<div class="mt-2 d-flex justify-content-between align-items-center">

    <!-- B√äN TR√ÅI: PAGE SIZE + PAGINATION -->
    <div class="d-flex align-items-center gap-3">

        <!-- CH·ªåN S·ªê D√íNG -->
        <div class="d-flex align-items-center gap-2">
            <label class="mb-0">Hi·ªÉn th·ªã</label>
            <select id="pageSize" class="form-select form-select-sm" style="width: 90px;"
                    onchange="searchData(0)">
                <option value="10" selected>10</option>
                <option value="50">50</option>
                <option value="100">100</option>
                <option value="500">500</option>
                <option value="1000">1000</option>
            </select>
        </div>

        <!-- PAGINATION -->
        <div id="pagination" class="d-flex gap-1"></div>

    </div>

    <!-- B√äN PH·∫¢I: T·ªîNG S·ªê H√ÄNG -->
    <div id="totalCountLabel" class="fw-bold">
        T·ªïng s·ªë b·∫£n ghi: <span id="totalElements" th:text="${totalElements}">0</span>
    </div>

</div>
<!-- ‚≠ê‚≠ê‚≠ê K·∫æT TH√öC BLOCK ‚≠ê‚≠ê‚≠ê -->

<!-- ======================= MODAL ======================= -->
<div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Th√™m / S·ª≠a</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                <input type="hidden" id="id">

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label>S·ªë TT</label>
                        <input type="text" id="orderNumber" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Ng√†y TL</label>
                        <input id="sttNgayTl" class="form-control" placeholder="dd-MM-yyyy">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>B·∫£n √°n - Quy·∫øt ƒë·ªãnh</label>
                        <input type="text" id="banAnQuyetDinh" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Ng∆∞·ªùi ph·∫£i thi h√†nh</label>
                        <input type="text" id="personWhoMustExecute" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Ng∆∞·ªùi ƒë∆∞·ª£c thi h√†nh</label>
                        <input type="text" id="personToBeExecuted" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Qƒê ·ª¶y th√°c ƒëi</label>
                        <input type="text" id="qdUyThacDi" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Qƒê ·ª¶y th√°c ƒë·∫øn</label>
                        <input type="text" id="qdUyThacDen" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Qƒê THA d√¢n s·ª±</label>
                        <input type="text" id="qdTha" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>N·ªôi dung thi h√†nh</label>
                        <input type="text" id="ndThiHanh" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Qƒê ch∆∞a c√≥ ƒëi·ªÅu ki·ªán</label>
                        <input type="text" id="qdChuaCoDieuKien" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Qƒê r√∫t THA</label>
                        <input type="text" id="qdRutTha" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Qƒê ho√£n THA</label>
                        <input type="text" id="qdHoanTha" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Qƒê ti·∫øp t·ª•c sau ho√£n</label>
                        <input type="text" id="qdTiepTucSauHoan" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Qƒê t·∫°m ƒë√¨nh ch·ªâ</label>
                        <input type="text" id="qdTamDinhChi" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Qƒê ti·∫øp t·ª•c sau t·∫°m ƒë√¨nh ch·ªâ</label>
                        <input type="text" id="qdTiepTucSauTamDinhChi" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Qƒê ƒë√¨nh ch·ªâ</label>
                        <input type="text" id="qdDinhChi" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>ƒê√£ thi h√†nh xong</label>
                        <input type="text" id="daThiHanhXong" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Ki·ªÉm s√°t vi√™n</label>
                        <input type="text" id="ghiChu" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>V·ªÅ th·ªùi h·∫°n g·ª≠i Qƒê</label>
                        <input type="text" id="veThoiHanGuiQD" class="form-control">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label>V·ªÅ cƒÉn c·ª© ban h√†nh Qƒê</label>
                        <input type="text" id="veCanCuBanHanhQD" class="form-control">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label>V·ªÅ th·∫©m quy·ªÅn ban h√†nh Qƒê</label>
                        <input type="text" id="veThamQuyenBanHanhQD" class="form-control">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label>V·ªÅ h√¨nh th·ª©c c·ªßa Qƒê</label>
                        <input type="text" id="veHinhThucQD" class="form-control">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label>V·ªÅ n·ªôi dung c·ªßa Qƒê</label>
                        <input type="text" id="veNoiDungQD" class="form-control">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label>Nh·ªØng n·ªôi dung kh√°c</label>
                        <input type="text" id="noiDungKhac" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>M√£ Phi·∫øu</label>
                        <input type="text" id="maPhieu" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>T√™n Vi·ªán KSND C·∫•p</label>
                        <input type="text" id="vienKsndCap" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Khu v·ª±c</label>
                        <input type="text" id="khuVuc" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Quan ƒëi·ªÉm c·ªßa KSV</label>
                        <input type="text" id="quanDiemKSV" class="form-control">
                    </div>

                </div>
            </div>

            <div class="modal-footer">
                <button type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal">ƒê√≥ng</button>

                <button class="btn btn-primary" onclick="saveItem()">L∆∞u</button>
            </div>

        </div>
    </div>
</div>


<!-- ================== JAVASCRIPT ================== -->
<script>

    /* ====== Flatpickr cho t·∫•t c·∫£ input ng√†y ====== */
    flatpickr("#searchFrom", { dateFormat: "d-m-Y" });
    flatpickr("#searchTo", { dateFormat: "d-m-Y" });
    flatpickr("#sttNgayTl", { dateFormat: "d-m-Y" });


    /* ====== M·ªû MODAL TH√äM ====== */
    function openCreateModal() {
        $("#modalTitle").text("Th√™m m·ªõi");
        $("#id").val("");
        $("#editModal input").val("");
        $("#editModal").modal("show");
    }


    /* ====== L·∫§Y D·ªÆ LI·ªÜU EDIT ====== */
    function openEditModal(id) {
        $.get("/api/so-thu-ly/" + id, function (d) {
            $("#id").val(d.id);
            $("#sttNgayTl").val(d.sttNgayTl);
            $("#banAnQuyetDinh").val(d.banAnQuyetDinh);
            $("#orderNumber").val(d.orderNumber);
            $("#personWhoMustExecute").val(d.personWhoMustExecute);
            $("#personToBeExecuted").val(d.personToBeExecuted);
            $("#qdUyThacDi").val(d.qdUyThacDi);
            $("#qdUyThacDen").val(d.qdUyThacDen);
            $("#qdTha").val(d.qdTha);
            $("#ndThiHanh").val(d.ndThiHanh);
            $("#qdChuaCoDieuKien").val(d.qdChuaCoDieuKien);
            $("#qdRutTha").val(d.qdRutTha);
            $("#qdHoanTha").val(d.qdHoanTha);
            $("#qdTiepTucSauHoan").val(d.qdTiepTucSauHoan);
            $("#qdTamDinhChi").val(d.qdTamDinhChi);
            $("#qdTiepTucSauTamDinhChi").val(d.qdTiepTucSauTamDinhChi);
            $("#qdDinhChi").val(d.qdDinhChi);
            $("#daThiHanhXong").val(d.daThiHanhXong);
            $("#ghiChu").val(d.ghiChu);
            $("#veThoiHanGuiQD").val(d.veThoiHanGuiQD);
            $("#veCanCuBanHanhQD").val(d.veCanCuBanHanhQD);
            $("#veThamQuyenBanHanhQD").val(d.veThamQuyenBanHanhQD);
            $("#veHinhThucQD").val(d.veHinhThucQD);
            $("#veNoiDungQD").val(d.veNoiDungQD);
            $("#noiDungKhac").val(d.noiDungKhac);
            $("#quanDiemKSV").val(d.quanDiemKSV);
            $("#maPhieu").val(d.maPhieu);
            $("#vienKsndCap").val(d.vienKsndCap);
            $("#khuVuc").val(d.khuVuc);
            $("#editModal").modal("show");
        });
    }


    /* ====== L∆ØU ====== */
    function saveItem() {
        showLoader();
        let data = {
            id: $("#id").val(),
            sttNgayTl: $("#sttNgayTl").val(),
            banAnQuyetDinh: $("#banAnQuyetDinh").val(),
            orderNumber: $("#orderNumber").val(),
            personWhoMustExecute: $("#personWhoMustExecute").val(),
            personToBeExecuted: $("#personToBeExecuted").val(),
            qdUyThacDi: $("#qdUyThacDi").val(),
            qdUyThacDen: $("#qdUyThacDen").val(),
            qdTha: $("#qdTha").val(),
            ndThiHanh: $("#ndThiHanh").val(),
            qdChuaCoDieuKien: $("#qdChuaCoDieuKien").val(),
            qdRutTha: $("#qdRutTha").val(),
            qdHoanTha: $("#qdHoanTha").val(),
            qdTiepTucSauHoan: $("#qdTiepTucSauHoan").val(),
            qdTamDinhChi: $("#qdTamDinhChi").val(),
            qdTiepTucSauTamDinhChi: $("#qdTiepTucSauTamDinhChi").val(),
            qdDinhChi: $("#qdDinhChi").val(),
            daThiHanhXong: $("#daThiHanhXong").val(),
            ghiChu: $("#ghiChu").val(),
            veThoiHanGuiQD: $("#veThoiHanGuiQD").val(),
            veCanCuBanHanhQD: $("#veCanCuBanHanhQD").val(),
            veThamQuyenBanHanhQD: $("#veThamQuyenBanHanhQD").val(),
            veHinhThucQD: $("#veHinhThucQD").val(),
            veNoiDungQD: $("#veNoiDungQD").val(),
            noiDungKhac: $("#noiDungKhac").val(),
            maPhieu: $("#maPhieu").val(),
            vienKsndCap: $("#vienKsndCap").val(),
            khuVuc: $("#khuVuc").val(),
            quanDiemKSV: $("#quanDiemKSV").val()
        };

        $.ajax({
            url: "/api/so-thu-ly",
            method: data.id ? "PUT" : "POST",
            contentType: "application/json",
            data: JSON.stringify(data),
            success: function () {
                searchData(0); // reload b·∫±ng AJAX, kh√¥ng reload page
                $("#editModal").modal("hide");
            }, complete: function () {
                hideLoader();   // üî• lu√¥n ch·∫°y
            }
        });
    }


    /* ====== X√ìA ====== */
    function deleteItem(id) {
        if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a?")) return;
        showLoader();
        $.ajax({
            url: "/api/so-thu-ly/" + id,
            method: "DELETE",
            success: function () {
                searchData(0);
            }, complete: function () {
                hideLoader();   // üî• lu√¥n ch·∫°y
            }
        });
    }

    function deleteMultiple() {
        let ids = [];

        $(".row-check:checked").each(function() {
            ids.push($(this).val());
        });

        if (ids.length === 0) {
            alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 h√†ng ƒë·ªÉ x√≥a!");
            return;
        }

        if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a " + ids.length + " b·∫£n ghi n√†y?")) return;

        showLoader();

        $.ajax({
            url: "/api/so-thu-ly/delete-multiple",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify(ids),
            success: function () {
                searchData(0);
            },
            complete: function () {
                hideLoader();
            }
        });
    }


    /* ====== EXPORT ====== */
    function exportExcel() {
        showLoader();
        window.location.href = "/api/so-thu-ly/export";
        setTimeout(hideLoader, 2000);
    }


    /* ====== DOWNLOAD DOC ====== */
    function showloadFileDoc(id) {
        if (!confirm("B·∫°n c√≥ mu·ªën download file DOC?")) return;

        showLoader();

        $.ajax({
            url: "/api/so-thu-ly/download-doc/" + id,
            method: "GET",
            xhrFields: {
                responseType: 'blob'   // nh·∫≠n file d·∫°ng blob
            },
            success: function (data, status, xhr) {

                // L·∫•y t√™n file t·ª´ header n·∫øu c√≥
                let filename = "";
                let disposition = xhr.getResponseHeader('Content-Disposition');
                if (disposition && disposition.indexOf('attachment') !== -1) {
                    let match = disposition.match(/filename="?([^"]+)"?/);
                    if (match && match[1]) filename = match[1];
                }
                if (!filename) filename = "download.docx";

                // T·∫°o Blob
                let blob = new Blob([data], {
                    type: "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
                });

                // T·∫°o link ·∫£o
                let link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                link.download = filename;

                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                hideLoader();
            },
            error: function () {
                alert("Kh√¥ng th·ªÉ download file!");
                hideLoader();
            }
        });
    }


    /* ====== SEARCH AJAX + PAGINATION ====== */
    function searchData(page = 0) {
        showLoader();
        $.ajax({
            url: "/api/so-thu-ly/search",
            method: "GET",
            data: {
                from: $("#searchFrom").val(),
                to: $("#searchTo").val(),
                page: page,
                size: $("#pageSize").val()
            },
            success: function (res) {
                renderTable(res.content);
                renderPagination(res);
                var totalElements = res.totalElements;
                $("#totalCountLabel").text("T·ªïng s·ªë b·∫£n ghi: " + totalElements);
            }, complete: function () {
                hideLoader();   // üî• lu√¥n ch·∫°y
            }
        });
    }


    function renderTable(list) {
        let html = "";
        let index = 1;

        list.forEach(item => {
            html += `
                <tr>
                    <td class="text-center">
                        <input type="checkbox" class="row-check" value="${item.id}">
                    </td>
                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${index++}</span>
                    </td>
                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.formatDateNgayTl || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.banAnQuyetDinh || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.personWhoMustExecute || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.personToBeExecuted || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.qdUyThacDi || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.qdUyThacDen || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.qdTha || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.ndThiHanh || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.qdChuaCoDieuKien || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.qdRutTha || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.qdHoanTha || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.qdTiepTucSauHoan || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.qdTamDinhChi || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.qdTiepTucSauTamDinhChi || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.qdDinhChi || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.daThiHanhXong || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.ghiChu || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.veThoiHanGuiQD || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.veCanCuBanHanhQD || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.veThamQuyenBanHanhQD || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.veHinhThucQD || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.veNoiDungQD || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.noiDungKhac || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.quanDiemKSV || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.khuVuc || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.vienKsndCap || ""}</span>
                    </td>

                    <td>
                        <button class="btn-copy" onclick="copyTdValue(this)"><i class="fa fa-copy"></i></button>
                        <span>${item.maPhieu || ""}</span>
                    </td>
                    <td class="sticky-action">
                        <button class="btn btn-warning btn-sm" onclick="openEditModal(${item.id})">S·ª≠a</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteItem(${item.id})">X√≥a</button>
                        <button class="btn btn-info btn-sm" onclick="showloadFileDoc(${item.id})"><i class="fa fa-download"></i> .Doc</button>
                        <button class="btn btn-secondary btn-sm mt-1" onclick="copyRow(${item.id})">Copy h√†ng</button>
                    </td>
                </tr>
            `;
        });

        $("#tableBody").html(html);
    }

    function copyRow(id) {
        if (!confirm("B·∫°n c√≥ mu·ªën copy h√†ng n√†y v√† t·∫°o m·ªôt b·∫£n ghi m·ªõi?")) return;
        showLoader();

        $.ajax({
            url: "/api/so-thu-ly/copy/" + id,   // endpoint copy (s·∫Ω t·∫°o m·ªõi 1 b·∫£n ghi)
            method: "POST",
            success: function () {
                // sau khi copy xong, load l·∫°i page 0 ƒë·ªÉ th·∫•y h√†ng m·ªõi tr√™n ƒë·∫ßu
                searchData(0);
            },
            error: function () {
                alert("C√≥ l·ªói x·∫£y ra khi copy h√†ng!");
            }, complete: function () {
                hideLoader();   // üî• lu√¥n ch·∫°y
            }
        });
    }

    function toggleCheckAll(cb) {
        $(".row-check").prop("checked", cb.checked);
    }

    function copyTdValue(btn) {
        const td = btn.parentElement;
        const value = td.querySelector("span").innerText.trim();

        navigator.clipboard.writeText(value).then(() => {

            // T·∫°o tooltip
            let tooltip = document.createElement("div");
            tooltip.className = "copy-tooltip";
            tooltip.innerText = "ƒê√£ copy!";

            // Th√™m v√†o body ƒë·ªÉ n√≥ t√°ch kh·ªèi td
            document.body.appendChild(tooltip);

            // L·∫•y v·ªã tr√≠ button ƒë·ªÉ ƒë·∫∑t tooltip ƒë√∫ng ch·ªó
            const rect = btn.getBoundingClientRect();

            tooltip.style.left = rect.left + window.scrollX + "px";
            tooltip.style.top = rect.top + window.scrollY - 30 + "px"; // n·∫±m tr√™n n√∫t 30px

            // hi·ªáu ·ª©ng fade
            setTimeout(() => {
                tooltip.classList.add("fade-out");
            }, 700);

            // xo√° tooltip
            setTimeout(() => {
                tooltip.remove();
            }, 1000);
        });
    }


    function renderPagination(res) {
        let current = res.number;
        let total = res.totalPages;

        let html = "";

        for (let i = 0; i < total; i++) {
            html += `
                <button class="btn btn-sm ${i === current ? "btn-primary" : "btn-outline-primary"}"
                        onclick="searchData(${i})">
                    ${i + 1}
                </button>
            `;
        }

        $("#pagination").html(html);
    }


    /* ====== LOAD L·∫¶N ƒê·∫¶U ====== */
    $(document).ready(function () {
        searchData(0);
    });


    /* ====== HI·ªÜU ·ª®NG RIPPLE KHI CLICK BUTTON ====== */
    document.addEventListener("click", function (e) {
        const target = e.target;

        // n·∫øu click l√† button ho·∫∑c n·∫±m trong button
        const btn = target.closest(".btn, .btn-copy");
        if (!btn) return;

        const rect = btn.getBoundingClientRect();
        const circle = document.createElement("span");
        const diameter = Math.max(rect.width, rect.height);
        const radius = diameter / 2;

        circle.style.width = circle.style.height = `${diameter}px`;
        circle.style.left = `${e.clientX - rect.left - radius}px`;
        circle.style.top = `${e.clientY - rect.top - radius}px`;
        circle.classList.add("ripple");

        // Xo√° ripple c≈© n·∫øu c√≥
        const oldRipple = btn.querySelector(".ripple");
        if (oldRipple) {
            oldRipple.remove();
        }

        btn.appendChild(circle);

        // ripple t·ª± m·∫•t sau khi animation xong
        setTimeout(() => circle.remove(), 600);
    });

</script>

</body>
</html>
